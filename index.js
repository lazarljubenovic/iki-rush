!function(){"use strict";function t(t,n){return t>n||((t,n)=>1e-6>Math.abs(t-n))(t,n)}function n(t,n){let o=t();for(;n(o);)o=t();return o}function o(t){return"number"==typeof t?t:0}function r(t,n,{i:o,j:r}){return 0==o?null:{i:o-1,j:r}}function e(t,n,{i:o,j:r}){return o==t-1?null:{i:o+1,j:r}}function i(t,n,{i:o,j:r}){return 0==r?null:{i:o,j:r-1}}function s(t,n,{i:o,j:r}){return r==n-1?null:{i:o,j:r+1}}function c(t,n){return null!=t&&null!=n&&t.i==n.i&&t.j==n.j}function a(t,n){return{i:t.i+n.i,j:t.j+n.j}}function u(t){return`[data-i="${t.i}"][data-j="${t.j}"]`}function l(t,{i:n,j:o}){const r=n>=0,e=n<=t.width-1,i=o>=0,s=o<=t.height-1;return r&&e&&i&&s}const f=t=>document.querySelector(t),m=t=>document.createElement(t),h=t=>document.createElementNS("http://www.w3.org/2000/svg",t);function d(t,n){const o=t,r=n,{PI:e,sin:i,sqrt:s}=Math;return s(2*r**2*e/(o*i(2*e/o)))}function p(t,n,o){return((t,n=1,o=0)=>Array.from({length:t}).map((r,e)=>o+(n-o)/t*e))(t,2*Math.PI).map(t=>t+o).map(t=>({x:n*Math.sin(t),y:n*Math.cos(t)}))}function j(t){return t.map(({x:t,y:n})=>`${t},${n}`).join(" ")}function g(t,n){n.appendChild(t.firstChild),t.appendChild(n.firstChild)}function y(t){return{t:()=>f(u(t)),animation:[{transform:"scale(1)",opacity:1},{transform:"scale(.5)",opacity:0}],options:{duration:120,o:"cubic-bezier(.54,-0.34,.94,.44)"}}}function b(t){const n=t.map(y);return{group:n,s(){n.forEach(t=>{const n=t.t();n.removeChild(n.firstChild)})}}}const M=100,v="linear";function w(t){return{group:[...t.u.map(t=>{const n=f(u(t.l)),o=f(u(a(t.l,{i:-t.m,j:0}))),r=[{transform:"translateY(0)"},{transform:`translateY(calc(${t.m} * var(--size)))`}];return{t:n,animation:r,options:{duration:t.m*M,o:v},s(){o.appendChild(n.firstChild)}}}),...t.h.map(n=>{const o=t.p[n.l.j],r={i:o,j:0},e=f(u(a(n.l,r))),i=`translateY(calc(${o} * var(--size)))`,s=f(u(n.l));return{t:e,animation:[{transform:"translateY(0)",opacity:0},{opacity:1,offset:1/o},{transform:i}],options:{duration:o*M,o:v},s(){s.appendChild(e.firstChild)}}})],g:100,M(){t.h.forEach(n=>{const o={i:t.p[n.l.j],j:0},r=a(n.l,o),e=T(n.color);f(u(r)).appendChild(e)})}}}var z;function x(t,n=3){const o=[];for(let r=0;r<t.length;r++){let e=t[r][0],i=1,s=0;for(let c=1;c<t[r].length;c++){const a=t[r][c];e==a?i++:(n>i||o.push({type:z.v,color:e,length:i,from:{i:r,j:s},Y:{i:r,j:c-1}}),i=1,s=c),e=a}n>i||o.push({type:z.v,color:e,length:i,from:{i:r,j:s},Y:{i:r,j:t[r].length-1}})}return o}function Y(t,n=3){const o=[];for(let r=0;r<t[0].length;r++){let e=t[0][r],i=1,s=0;for(let c=1;c<t.length;c++){const a=t[c][r];e==a?i++:(n>i||o.push({type:z.$,color:e,length:i,from:{i:s,j:r},Y:{i:c-1,j:r}}),i=1,s=c),e=a}n>i||o.push({type:z.$,color:e,length:i,from:{i:s,j:r},Y:{i:t.length-1,j:r}})}return o}function $(t){const n=[];for(const r of t){const t=(o=r).type==z.v?(t=>{const n=[],o=t.from.i,r=Math.min(t.from.j,t.Y.j),e=Math.max(t.from.j,t.Y.j);for(let t=r;e>=t;t++)n.push({i:o,j:t});return n})(o):(t=>{const n=[],o=t.from.j,r=Math.min(t.from.i,t.Y.i),e=Math.max(t.from.i,t.Y.i);for(let t=r;e>=t;t++)n.push({i:t,j:o});return n})(o);for(const o of t)null==n.find(t=>c(t,o))&&n.push(o)}var o;return n}function E(t,n){for(const{i:o,j:r}of n)t.data[o][r]=-1;const o=[],r=[],e=Array.from({length:t.data[0].length}).fill(0);for(let n=0;n<t.width;n++){let r=0;for(let e=0;e<t.height;e++)-1!=t.data[e][n]?r>0&&o.push({l:{i:e,j:n},m:r}):r++;e[n]=r}for(const{l:{i:n,j:r},m:e}of o)t.data[n-e][r]=t.data[n][r];for(let n=0;n<e.length;n++)for(let o=0;o<e[n];o++){const e=t.T.next().value,i=t.height-1-o,s=n;t.data[i][s]=e,r.push({color:e,l:{i:i,j:s}})}return{u:o,h:r,p:e}}function T(t){const n=h("svg");n.setAttribute("viewBox","-50 -50 100 100");const o=h("use"),r=`shape-${t}`;return o.setAttribute("href","#"+r),n.appendChild(o),n}function C(t){const n=t.parentElement;return{i:X-1-n.rowIndex,j:t.cellIndex}}(t=>{t[t.v=1]="Horizontal",t[t.$=2]="Vertical"})(z||(z={})),(()=>document.querySelectorAll("noscript"))().forEach(t=>t.remove()),((t,n=document.body)=>{const o=h("svg");o.setAttribute("hidden",""),o.id="definitions";const r=h("defs");{const t=h("g");t.id="shape-0";const n=h("circle");n.setAttribute("cx","0"),n.setAttribute("xy","0"),n.setAttribute("r","30"),t.appendChild(n),r.appendChild(t)}for(let t=0;6>t;t++){const n=4+2*Math.floor(t/2),o=2*Math.PI/n,e=t%2==1,i=h("g");i.id=`shape-${t+1}`;const s=h("polygon"),c=p(n,d(n,30),Math.PI/2+(e?o/2:0));s.setAttribute("points",j(c)),i.appendChild(s),r.appendChild(i)}o.appendChild(r),n.insertBefore(o,n.firstChild)})();const X=8,A=((o,r,e)=>{const i=m("table");for(let t=0;e>t;t++){const t=i.insertRow();for(let n=0;8>n;n++)t.insertCell()}const s=m("div");s.id="board",s.appendChild(i),o.appendChild(s);const c=(t=>{const o=[];for(let r=0;t.height>r;r++){o[r]=Array(t.width);for(let e=0;t.width>e;e++){const i=[];if(e>=2){const[t,n]=[o[r][e-1],o[r][e-2]];t==n&&i.push(t)}if(e>=2&&r>=2){const[t,n]=[o[r-1][e-1],o[r-2][e-2]];t==n&&i.push(t)}if(r>=2){const[t,n]=[o[r-1][e],o[r-2][e]];t==n&&i.push(t)}if(t.width-e>2&&r>=2){const[t,n]=[o[r-1][e+1],o[r-2][e+2]];t==n&&i.push(t)}o[r][e]=n(()=>t.T.next().value,t=>i.includes(t))}}return Object.assign({},t,{data:o})})({C:7,width:8,height:e,T:{next:()=>({value:(()=>{let n=0,o=0;const r=1/Math.random();for(;!t(o+=r,7);)n++;return n})(),done:!1})}}),a=document.createDocumentFragment();c.data.forEach((t,n)=>{t.forEach((t,o)=>{const r=m("div");r.dataset.i=n.toString(),r.dataset.j=o.toString(),r.appendChild(T(t)),a.appendChild(r)})});for(let t=X;X+8>t;t++)for(let n=0;8>n;n++){const o=m("div");o.dataset.i=t.toString(),o.dataset.j=n.toString(),a.appendChild(o)}return s.appendChild(a),c})(f("#game"),0,X);let H=null,I=null;function L(t){const n=t.target;if(!(n instanceof HTMLTableCellElement))return;const o=C(n);I=o}f("table").addEventListener("mousedown",t=>{const n=t.target;n instanceof HTMLTableCellElement&&(H=C(n))}),document.body.addEventListener("mouseenter",()=>{H=null,I=null}),document.body.addEventListener("mouseup",t=>{null!=H&&(L(t),(()=>{const t=H,n=I;H=null,I=null;const o={i:Math.sign(n.i-t.i),j:Math.sign(n.j-t.j)};if(0==o.i&&0==o.j)return;if(0!=o.i&&0!=o.j)return;const m=t,h=a(t,o);var d,p;((t,n,o)=>{if(!((t,n,o)=>{const a=l(t,n),u=l(t,o),{width:f,height:m}=t;return!(!a||!u)&&(c(r(0,0,n),o)||c(r(0,0,o),n)||c(e(f,0,n),o)||c(e(f,0,o),n)||c(s(0,m,n),o)||c(s(0,m,o),n)||c(i(0,0,n),o)||c(i(0,0,o),n))})(t,n,o))throw Error("Illegal swap.");const[a,u,f,m]=[n.i,n.j,o.i,o.j],h=t.data[a][u];t.data[a][u]=t.data[f][m],t.data[f][m]=h})(A,m,h),k.add((p=h,(d=m).i==p.i?function t(n,o){if(n.j>o.j)return t(o,n);const r=()=>f(u(n)),e=()=>f(u(o)),i={duration:200,o:"cubic-bezier(.35,-0.04,.72,1.19)"};return{group:[{t:r,animation:[{transform:"translateX(0)"},{transform:"translateX(var(--size))"}],options:i},{t:e,animation:[{transform:"translateX(0)"},{transform:"translateX(calc((-1) * var(--size)))"}],options:i}],s(){g(r(),e())}}}(d,p):function t(n,o){if(o.i>n.i)return t(o,n);const r=()=>f(u(n)),e=()=>f(u(o)),i={duration:200,o:"cubic-bezier(.35,-0.04,.72,1.19)"};return{group:[{t:r,animation:[{transform:"translateY(0)"},{transform:"translateY(var(--size))"}],options:i},{t:e,animation:[{transform:"translateY(0)"},{transform:"translateY(calc((-1) * var(--size)))"}],options:i}],s(){g(r(),e())}}}(d,p)));let j=3;for(;;){if(0>j--)throw Error("infi loop");const t=$([...x(A.data),...Y(A.data)]);if(0==t.length)break;k.add(b(t));const n=E(A,t);k.add(w(n))}})())}),f("table").addEventListener("mouseout",L);const k=new class{constructor(){this.X=[],this.A=!1}H(){if(this.A||this.I())return;this.A=!0;const t=this.X.shift();null!=t.M&&t.M();const n=t.group.reduce((t,n)=>{const r=o(t.options.duration);return o(n.options.duration)>r?n:t});let r;t.group.forEach(t=>{const o=(t=>"function"==typeof t?t():t)(t.t).animate(t.animation,t.options);null!=t.s&&o.addEventListener("finish",t.s),t==n&&(r=o)}),r.addEventListener("finish",()=>{t.s&&t.s(),this.A=!1,setTimeout(()=>{this.H()},t.g||0)})}I(){return 0==this.X.length}add(t){this.X.push(t),this.H()}}}();
